<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    
    <!-- Cache busting headers melhorados -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="cache-control" content="no-cache" />
    
    <!-- PWA Meta Tags -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="theme-color" content="#ec4899" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Maternidade" />
    <meta name="mobile-web-app-capable" content="yes" />
    
    <!-- SEO Meta Tags -->
    <title>Maternidade - Acompanhamento Completo de Gravidez</title>
    <meta name="description" content="Aplicativo completo para acompanhamento da gravidez com recursos 3D, monitoramento detalhado, contador de chutes, di√°rio e comunidade de m√£es." />
    <meta name="keywords" content="gravidez, maternidade, beb√™, acompanhamento, chutes, peso, di√°rio, comunidade" />
    
    <!-- Open Graph -->
    <meta property="og:title" content="Maternidade - Acompanhamento de Gravidez" />
    <meta property="og:description" content="Aplicativo completo para acompanhar sua gravidez com recursos 3D e comunidade" />
    <meta property="og:type" content="website" />
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />
    
    <!-- Fontes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- Debug script para problemas de cache -->
    <script>
      console.log('üîß HTML carregado - timestamp:', new Date().toISOString());
      console.log('üîß User Agent:', navigator.userAgent);
      console.log('üîß Performance Navigation Type:', performance.navigation.type);
      
      // Modo desenvolvimento
      if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        console.log('üîß Modo desenvolvimento');
      }
      
      // LIMPEZA INTELIGENTE DE CACHE
      if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
        const lastCleanup = localStorage.getItem('lastCacheCleanup');
        const now = Date.now();
        const oneDay = 24 * 60 * 60 * 1000; // 24 horas
        
        // S√≥ limpa cache se passou mais de 1 dia
        if (!lastCleanup || (now - parseInt(lastCleanup)) > oneDay) {
          console.log('üßπ Limpando cache (primeira vez ou ap√≥s 24h)...');
          
          // Desregistrar service workers antigos
          if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
              for(let registration of registrations) {
                console.log('üóëÔ∏è Desregistrando SW antigo:', registration);
                registration.unregister();
              }
            });
          }
          
          // Limpar caches antigos (mas manter dados importantes)
          if ('caches' in window) {
            caches.keys().then(function(names) {
              for (let name of names) {
                if (name.includes('vite') || name.includes('static')) {
                  console.log('üóëÔ∏è Removendo cache antigo:', name);
                  caches.delete(name);
                }
              }
            });
          }
          
          // Salvar timestamp da limpeza
          localStorage.setItem('lastCacheCleanup', now.toString());
          console.log('‚úÖ Cache limpo e timestamp salvo');
        } else {
          console.log('‚úÖ Cache ainda v√°lido, n√£o precisa limpar');
        }
      }
      
      // Log any errors
      window.addEventListener('error', (e) => {
        console.error('‚ùå JavaScript Error:', e.error);
        console.error('‚ùå Error details:', {
          message: e.message,
          filename: e.filename,
          lineno: e.lineno,
          colno: e.colno
        });
      });
      
      window.addEventListener('unhandledrejection', (e) => {
        console.error('‚ùå Unhandled Promise Rejection:', e.reason);
      });
      
      // Monitora mudan√ßas no service worker
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.addEventListener('controllerchange', () => {
          console.log('üîÑ Service Worker mudou - recarregando p√°gina');
          window.location.reload();
        });
      }
    </script>
    
    <!-- PWA Installation Script -->
    <script>
      // Registrar Service Worker APENAS EM PRODU√á√ÉO
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', async () => {
          // DESABILITAR EM DESENVOLVIMENTO para evitar problemas de cache
          if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            console.log('üîß Service Worker desabilitado em desenvolvimento');
            
            // Desregistrar qualquer SW existente
            const registrations = await navigator.serviceWorker.getRegistrations();
            for (let registration of registrations) {
              await registration.unregister();
              console.log('üóëÔ∏è Service Worker desregistrado:', registration);
            }
            
            // Limpar todos os caches
            const cacheNames = await caches.keys();
            for (let cacheName of cacheNames) {
              await caches.delete(cacheName);
              console.log('üóëÔ∏è Cache removido:', cacheName);
            }
            
            return;
          }
          
          // Registrar apenas em produ√ß√£o
          try {
            const registration = await navigator.serviceWorker.register('/sw.js', {
              scope: '/',
              updateViaCache: 'none'
            });
            
            console.log('‚úÖ SW registrado com sucesso:', registration);
            
            // Verifica atualiza√ß√µes periodicamente
            setInterval(() => {
              registration.update();
            }, 30000);
            
          } catch (error) {
            console.error('‚ùå Falha no registro do SW:', error);
          }
        });
      }
    </script>
    
    <!-- Replit banner -->
    <script type="text/javascript" src="https://replit.com/public/js/replit-dev-banner.js"></script>
  </body>
</html>